---
layout: post
title: 임계구역 해결 방법
date: 2022-08-06 02:00:00 + 0900
categories: OS
ref: OS, critical section, monitor
---

# 임계구역 해결 방법

## 1. 임계구역은 어떤 경우에 발생하는가?
<figure>
  <img src="https://user-images.githubusercontent.com/13375810/183125719-8bae2489-9508-4f8d-bd5a-57150e8dc47e.png" width="55%"/>
  <figcaption></figcaption>
</figure>

### 1-1
단일 연결 리스트로 주소록을 구현하고 전역 변수에 저장 했습니다.    
그리고 사용자의 요청을 받아 주소록 조회, 추가, 삭제, 동기화 작업을 하는 UI 스레드와    
DB 에 네트워크 I/O 로 주소록을 저장, 삭제, 변경, 조회하는 Service 스레드가 존재합니다.    
<br/>
주소록에 ___1→2→3→4___ 가 저장되어 있고 UI 스레드에서 전체 조회 작업을 진행 중 이었습니다.    
그리고 동시에 Service 스레드에서 ___2-1___ 노드를 추가하려 합니다.   
<br/>
추가 작업은 ___2___ 노드의 링크를 ___2-1___ 노드로 옮기고 ___2-1___ 노드의 링크를 ___3___ 노드로 옮기는 여러 작업을 포함합니다.   
Service 스레드에서 ___2___ 노드의 링크를 ___2-1___ 노드로 연결하는 작업을 완료하기 전에    
UI 스레드가 ___2___ 노드에서 ___3___ 노드로 이동해 읽는다면,    
UI 스레드는 ___1→2→3→4___ , Service 스레드는 ___1→2-1→3→4___ 를 다른 주소록의 상태를 가집니다.    
이 경우 두 스레드는 동시성을 만족하지 못합니다.    
<br/>
비슷한 상황이 삭제 상황에서 발생한다면, UI 스레드는 이미 삭제된 노드를 읽어 프로세스가 죽어버릴 수 있습니다.

### 1-2
따라서 주소록이 저장된 전역 단일 연결 리스트 자료구조에 UI 스레드의 전체 읽기가 실행되는 동안   
Service 스레드에서 추가, 삭제, 변경이 일어나면 안됩니다.   
<br/>
DB 같은 자료구조에 접근하는 경우 DBMS 에서 동시성 제어를 해줘 이런 경우를 신경쓰지 않아도 되지만,   
일반적인 자료구조를 여러 스레드에서 동시에 접근 시 동시성 제어를 위해 작업 원자성 부여 등 처리를 해줘야 합니다.

## 2. 전역 변수로 잠금(Spin Lock)
<figure>
  <img src="https://user-images.githubusercontent.com/13375810/183125401-09782064-91d3-4802-8765-cabddd21be95.png" width="55%"/>
  <figcaption>▲ Spin Lock</figcaption>
</figure>

## 3. 모니터